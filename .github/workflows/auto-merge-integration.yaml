# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json
#
# Auto-Merge Integration PRs (Trust-Based)
#
# This workflow enables GitHub's native auto-merge on PRs to integration
# after W1 validation passes, using trust-based verification.
#
# Calls reusable workflow from aRustyDev/gh.
#
# See ADR-009 for details.

name: Auto-Merge Integration PRs

on:
  workflow_run:
    workflows: ["Validate Contribution PR"]
    types:
      - completed

permissions:
  contents: write
  pull-requests: write

jobs:
  auto-merge:
    if: >-
      github.event.workflow_run.conclusion == 'success' &&
      github.event.workflow_run.event == 'pull_request'
    uses: aRustyDev/gh/.github/workflows/atomic-release-auto-merge-trusted.yml@atomic-release-v0.1.0
    with:
      validation_workflow_name: "Validate Contribution PR"
      allowed_base_branches: ${{ vars.AUTO_MERGE_ALLOWED_BRANCHES || 'integration' }}
      require_verified_commits: true
      merge_method: squash
      trust_dependabot: true
      trust_codeowners: true
