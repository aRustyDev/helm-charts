# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json
#
# Tag Atomic Chart (W6-Tag)
#
# Creates release tags for charts when changes are merged to main.
# This workflow triggers on push to main with chart changes, then creates
# tags in the format <chart>-v<version> which trigger the release workflow.
#
# Calls reusable workflow from aRustyDev/gh.
#
# Flow:
#   Push to main (charts/**) -> W6-Tag creates tags -> W6 releases each tagged chart

name: Tag Atomic Chart

on:
  push:
    branches:
      - main
    paths:
      - 'charts/**'

permissions:
  contents: write

concurrency:
  group: chart-tag-${{ github.sha }}
  cancel-in-progress: false

jobs:
  create-tags:
    uses: aRustyDev/gh/.github/workflows/atomic-release-create-release-tags.yml@atomic-release-v0.1.0
    with:
      artifact_path: "charts"
      manifest_file: "Chart.yaml"
      github_app_id_secret_ref: "op://gh-shared/xauth/app/id"
      github_app_key_secret_ref: "op://gh-shared/xauth/app/private-key.pem"
    secrets:
      OP_SERVICE_ACCOUNT_TOKEN: ${{ secrets.OP_SERVICE_ACCOUNT_TOKEN }}
